<main class="container mx-auto p-2 sm:p-4 md:p-8 min-h-screen">

  @if (!showArena()) {
    <!-- Header -->
    <header class="relative text-center mb-4 h-20">
        <div class="absolute bottom-0 left-1/2 -translate-x-1/2 flex items-end gap-2">
            <div class="px-4 py-2 text-blue-300 font-bold text-xl opacity-70 cursor-pointer">Decks</div>
            <div class="px-8 py-3 bg-blue-600 rounded-t-lg border-2 border-b-0 border-blue-400 text-white font-bold text-2xl shadow-lg">Coleção</div>
        </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      
      <!-- Card Collection -->
      <div class="lg:col-span-2 bg-slate-800/50 rounded-2xl p-4 sm:p-6 border border-slate-700 shadow-2xl">
        <div class="h-[75vh] overflow-y-auto pr-2">
          @for(group of groupedCards(); track group.rarity) {
            <section class="mb-8">
              <h2 class="font-medieval text-3xl mb-4 text-slate-300 border-b-2 border-slate-700 pb-2">{{ group.rarity }}</h2>
              <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 xl:grid-cols-6 gap-2 sm:gap-4">
                @for (card of group.cards; track card.id) {
                  <div (click)="openCardDetail(card)" [class.opacity-50]="isCardInDeck(card)">
                     <app-card [card]="card" />
                  </div>
                }
              </div>
            </section>
          }
        </div>
      </div>

      <!-- User Deck -->
      <div class="lg:col-span-1 bg-slate-800/50 rounded-2xl p-6 border border-slate-700 shadow-2xl">
        <div class="sticky top-6">
          <h2 class="font-medieval text-4xl text-rose-400 mb-4">Seu Deck</h2>
          <div class="bg-gray-900/70 rounded-lg p-3 mb-4 flex justify-between items-center border border-slate-600">
            <span class="text-slate-300 font-bold">Custo Médio de Elixir:</span>
            <span class="font-medieval text-3xl text-fuchsia-400">{{ averageElixir() }}</span>
          </div>
          
          <div class="grid grid-cols-2 gap-4 mb-6">
            @for (card of deck(); track $index) {
              @if (card) {
                <div (click)="removeCardFromDeck($index)">
                  <app-card [card]="card" />
                </div>
              } @else {
                <div class="aspect-[3/4] bg-slate-900/50 border-2 border-dashed border-slate-600 rounded-lg flex items-center justify-center">
                  <span class="text-slate-500 text-sm">Vazio</span>
                </div>
              }
            }
          </div>

          <button (click)="enterArena()" [disabled]="!isDeckFull()" 
            class="w-full font-medieval text-3xl py-4 px-6 rounded-lg transition-all duration-300 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
            [class]="isDeckFull() ? 'bg-gradient-to-r from-green-500 to-emerald-600 hover:scale-105 text-white' : 'bg-gray-700 text-gray-400'">
            Batalhar!
          </button>
          @if (!isDeckFull()) {
            <p class="text-center text-sm mt-2 text-slate-400">Complete seu deck com 8 cartas para batalhar.</p>
          }

        </div>
      </div>
    </div>
  } @else {
    <app-arena [deck]="deck()" (exit)="exitArena()" />
  }

</main>

<!-- Card Detail Modal -->
@if (selectedCardForDetail(); as card) {
  <app-card-detail 
    [card]="card"
    (close)="closeCardDetail()"
    (useCard)="confirmAddToDeck($event)"
  />
}