<div class="w-full h-screen flex flex-col items-center p-2 overflow-hidden bg-slate-900">
  <!-- Container central com largura máxima -->
  <div class="w-full max-w-[540px] flex flex-col flex-1">

    <!-- Header -->
    <div class="w-full flex justify-between items-center mb-2 px-2">
      <h2 class="font-medieval text-3xl md:text-4xl text-amber-400">Arena</h2>
      <button
        (click)="exit.emit()"
        class="bg-red-600 hover:bg-red-700 font-bold py-1.5 px-4 rounded-lg text-sm md:text-base transition-colors"
      >
        Sair
      </button>
    </div>

    <!-- Arena Board -->
    <div
      #arenaBoard
      (click)="playCardOnArena($event)"
      class="w-full mx-auto aspect-[9/12] border-4 border-yellow-800 rounded-lg relative overflow-hidden shadow-2xl"
      [class.cursor-copy]="selectedCardIndex() !== null && gameStatus() === 'playing'"
      style="
        background-image: url('https://cdn.jsdelivr.net/gh/rodolfo-s/rpg-deck-builder-assets@main/arena/bg.jpg');
        background-size: cover;
        background-position: center;
      "
    >
      <!-- Rio -->
      <div
        class="absolute left-0 w-full bg-blue-500/80 border-y-4 border-blue-300/50 backdrop-blur-sm"
        style="top:50%; height:12%; transform:translateY(-50%);"
      ></div>

      <!-- Pontes -->
      <img
        src="https://cdn.jsdelivr.net/gh/rodolfo-s/rpg-deck-builder-assets@main/arena/bridge.png"
        alt="Bridge"
        class="absolute"
        style="top:50%; left:25%; width:12%; transform:translate(-50%, -50%);"
      />
      <img
        src="https://cdn.jsdelivr.net/gh/rodolfo-s/rpg-deck-builder-assets@main/arena/bridge.png"
        alt="Bridge"
        class="absolute"
        style="top:50%; right:25%; width:12%; transform:translate(50%, -50%);"
      />

      <!-- Torres Inimigo -->
      <div
        class="absolute"
        [style.left.%]="(TOWER_POSITIONS.enemy.king.x / ARENA_WIDTH) * 100"
        [style.top.%]="(TOWER_POSITIONS.enemy.king.y / ARENA_HEIGHT) * 100"
        style="transform: translate(-50%, -60%); width: 18%;"
      >
        <img
          src="https://cdn.jsdelivr.net/gh/rodolfo-s/rpg-deck-builder-assets@main/arena/tower_red_king.png"
          alt="Enemy King Tower"
          class="w-full h-auto"
          [class.damage-flash]="towerFlashing().enemy.king"
        />
        <div
          class="absolute -bottom-5 w-full text-center font-medieval text-xs md:text-lg text-white bg-red-900/80 rounded px-1 border border-red-500"
        >
          {{ towerHP().enemy.king }}
        </div>
      </div>

      <div
        class="absolute"
        [style.left.%]="(TOWER_POSITIONS.enemy.left.x / ARENA_WIDTH) * 100"
        [style.top.%]="(TOWER_POSITIONS.enemy.left.y / ARENA_HEIGHT) * 100"
        style="transform: translate(-50%, -55%); width: 14%;"
      >
        <img
          src="https://cdn.jsdelivr.net/gh/rodolfo-s/rpg-deck-builder-assets@main/arena/tower_red_princess.png"
          alt="Enemy Princess Tower"
          class="w-full h-auto"
          [class.damage-flash]="towerFlashing().enemy.left"
        />
        <div
          class="absolute -bottom-4 w-full text-center font-medieval text-[10px] md:text-base text-white bg-red-900/80 rounded px-1 border border-red-500"
        >
          {{ towerHP().enemy.left }}
        </div>
      </div>

      <div
        class="absolute"
        [style.left.%]="(TOWER_POSITIONS.enemy.right.x / ARENA_WIDTH) * 100"
        [style.top.%]="(TOWER_POSITIONS.enemy.right.y / ARENA_HEIGHT) * 100"
        style="transform: translate(-50%, -55%); width: 14%;"
      >
        <img
          src="https://cdn.jsdelivr.net/gh/rodolfo-s/rpg-deck-builder-assets@main/arena/tower_red_princess.png"
          alt="Enemy Princess Tower"
          class="w-full h-auto"
          [class.damage-flash]="towerFlashing().enemy.right"
        />
        <div
          class="absolute -bottom-4 w-full text-center font-medieval text-[10px] md:text-base text-white bg-red-900/80 rounded px-1 border border-red-500"
        >
          {{ towerHP().enemy.right }}
        </div>
      </div>

      <!-- Torres Jogador -->
      <div
        class="absolute"
        [style.left.%]="(TOWER_POSITIONS.player.king.x / ARENA_WIDTH) * 100"
        [style.top.%]="(TOWER_POSITIONS.player.king.y / ARENA_HEIGHT) * 100"
        style="transform: translate(-50%, -60%); width: 18%;"
      >
        <img
          src="https://cdn.jsdelivr.net/gh/rodolfo-s/rpg-deck-builder-assets@main/arena/tower_blue_king.png"
          alt="Player King Tower"
          class="w-full h-auto"
          [class.damage-flash]="towerFlashing().player.king"
        />
        <div
          class="absolute -bottom-5 w-full text-center font-medieval text-xs md:text-lg text-white bg-blue-900/80 rounded px-1 border border-blue-400"
        >
          {{ towerHP().player.king }}
        </div>
      </div>

      <div
        class="absolute"
        [style.left.%]="(TOWER_POSITIONS.player.left.x / ARENA_WIDTH) * 100"
        [style.top.%]="(TOWER_POSITIONS.player.left.y / ARENA_HEIGHT) * 100"
        style="transform: translate(-50%, -55%); width: 14%;"
      >
        <img
          src="https://cdn.jsdelivr.net/gh/rodolfo-s/rpg-deck-builder-assets@main/arena/tower_blue_princess.png"
          alt="Player Princess Tower"
          class="w-full h-auto"
          [class.damage-flash]="towerFlashing().player.left"
        />
        <div
          class="absolute -bottom-4 w-full text-center font-medieval text-[10px] md:text-base text-white bg-blue-900/80 rounded px-1 border border-blue-400"
        >
          {{ towerHP().player.left }}
        </div>
      </div>

      <div
        class="absolute"
        [style.left.%]="(TOWER_POSITIONS.player.right.x / ARENA_WIDTH) * 100"
        [style.top.%]="(TOWER_POSITIONS.player.right.y / ARENA_HEIGHT) * 100"
        style="transform: translate(-50%, -55%); width: 14%;"
      >
        <img
          src="https://cdn.jsdelivr.net/gh/rodolfo-s/rpg-deck-builder-assets@main/arena/tower_blue_princess.png"
          alt="Player Princess Tower"
          class="w-full h-auto"
          [class.damage-flash]="towerFlashing().player.right"
        />
        <div
          class="absolute -bottom-4 w-full text-center font-medieval text-[10px] md:text-base text-white bg-blue-900/80 rounded px-1 border border-blue-400"
        >
          {{ towerHP().player.right }}
        </div>
      </div>

      <!-- Tropas -->
      @for (troop of activeTroops(); track troop.id) {
        <app-troop [troop]="troop" />
      }

      <!-- Efeitos de Feitiço -->
      @for (effect of spellEffects(); track effect.id) {
        <div
          class="spell-explosion"
          [style.left.%]="(effect.position.x / ARENA_WIDTH) * 100"
          [style.top.%]="(effect.position.y / ARENA_HEIGHT) * 100"
          [style.width.%]="(effect.card.radius! * 2 / ARENA_WIDTH) * 100"
          [style.height.%]="(effect.card.radius! * 2 / ARENA_HEIGHT) * 100"
          [style.transform]="'translate(-50%, -50%)'"
          [style.background-color]="effect.card.id === 'fireball'
              ? 'rgba(255, 165, 0, 0.7)'
              : 'rgba(138, 43, 226, 0.6)'"
          [style.border]="'4px solid ' + (effect.card.id === 'fireball'
              ? 'rgba(255, 69, 0, 0.8)'
              : 'rgba(75, 0, 130, 0.8)')"
        ></div>
      }

      <!-- Game Over -->
      @if (gameStatus() !== 'playing') {
        <div class="absolute inset-0 bg-black/70 flex flex-col items-center justify-center z-50 animate-fade-in">
          <h2
            class="font-medieval text-5xl md:text-8xl text-center"
            [class.text-green-400]="gameStatus() === 'win'"
            [class.text-red-500]="gameStatus() === 'lose'"
          >
            @if (gameStatus() === 'win') { Vitória! }
            @if (gameStatus() === 'lose') { Derrota! }
          </h2>
          <button
            (click)="exit.emit()"
            class="mt-6 md:mt-8 bg-amber-500 hover:bg-amber-600 font-bold py-2.5 md:py-3 px-6 rounded-lg transition-colors text-xl md:text-2xl font-medieval"
          >
            Voltar ao Deck
          </button>
        </div>
      }
    </div>

    <!-- Mão & Elixir -->
    <div class="w-full mt-2">
      <!-- Elixir -->
      <div
        class="relative h-6 w-full max-w-sm mx-auto bg-gray-700 rounded-full flex items-center p-1 border-2 border-fuchsia-400/50 mb-2"
      >
        <div
          class="h-full bg-fuchsia-500 rounded-full transition-all duration-200"
          [style.width.%]="(elixir() / 10) * 100"
        ></div>
        <span class="absolute inset-0 flex items-center justify-center font-bold text-white drop-shadow-md text-sm">
          {{ displayElixir() }} / 10
        </span>
      </div>

      <!-- Mão -->
      <div class="flex justify-center items-end gap-2 h-32 md:h-40">
        @for (card of playerHand(); track $index) {
          <div
            (click)="selectCard(card, $index)"
            class="w-20 md:w-24 transition-all duration-200"
            [class.border-4]="selectedCardIndex() === $index"
            [class.border-yellow-300]="selectedCardIndex() === $index"
            [class.-translate-y-3]="selectedCardIndex() === $index"
            [class.opacity-50]="elixir() < card.elixirCost && selectedCardIndex() !== $index"
          >
            <app-card [card]="card" />
          </div>
        }
      </div>
    </div>
  </div>
</div>
